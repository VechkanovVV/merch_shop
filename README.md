# merch_shop

## Описание

**merch_shop** — это онлайн-магазин с поддержкой авторизации через JWT токены, возможностью покупки товаров, отправки монет другим пользователям и получения информации о аккаунте.

## Структура проекта

Проект содержит несколько основных частей:

- **Авторизация и регистрация** — система автоматически регистрирует нового пользователя при неудачной попытке авторизации.
- **Товары** — пользователи могут покупать товары из магазина, если у них достаточно средств.
- **Монеты** — поддержка отправки монет другим пользователям.
- **Информация о пользователе** — получение данных о текущем состоянии аккаунта, включая баланс и историю транзакций.

## Запуск проекта

### Шаг 1: Запуск Docker

Для того чтобы запустить проект, необходимо выполнить команду:
```bash
    docker-compose up --build
```
    
    

### Шаг 2: Генерация ключей

Если вы хотите перегенерировать ключи, которые используются для JWT, они должны быть сохранены в следующем каталоге:
    
    
    merch_shop\src\main\resources\certs
    

Для генерации этих ключей используйте команды OpenSSL:
```bash
openssl genpkey -algorithm RSA -out private.pem -pkeyopt rsa_keygen_bits:2048
openssl rsa -pubout -in private.pem -out public.pem
```

## API

Все API-запросы обрабатываются на localhost:8080.

### 1. Авторизация и регистрация
#### POST /api/auth

При успешной авторизации выдается JWT токен. Если пользователь не зарегистрирован, система автоматически его зарегистрирует и также выдаст JWT токен.

```JSON
{
  "username": "newuser",
  "password": "newpass"
}
```

Пример ответа:

```JSON
{
  "token": "jwt-token-here"
}
```

### 2. Отправка монет
#### POST /api/sendCoin

Этот эндпоинт позволяет отправить монеты другому пользователю.
Пример запроса:

```JSON
{
  "toUser": "targetUser",
  "amount": 100
}
```

Пример ответа:
```JSON
{
  "status": "success",
  "message": "Coins sent successfully"
}
```

### 3. Покупка товара
#### GET /api/buy/{item}

Покупка товара при достаточном балансе. Если у пользователя достаточно средств, товар будет куплен.

Пример ответа:

```JSON
{
  "status": "success",
  "message": "Purchase successful"
}
```

### 4. Информация о пользователе
#### GET api/info

Получение информации о пользователе, включая баланс монет и историю транзакций.
```JSON
{
  "coins": 500,
  "inventory": [
    {
      "type": "t-shirt",
      "quantity": 1
    },
    {
      "type": "cup",
      "quantity": 3
    }
  ],
  "coinHistory": {
    "received": [
      {
        "fromUser": "otherUser",
        "amount": 100
      }
    ],
    "sent": [
      {
        "toUser": "targetUser",
        "amount": 50
      }
    ]
  }
}
```

# Пример использования

Для примера использования можно посмотреть

https://disk.yandex.ru/i/AVJRf0qZIqvkBA